# Custom LibreChat image with Judge0 Code Interpreter integration
# Uses production image as base - frontend is pre-built and working
# Pinned to v0.8.1-rc1 to match local code version
FROM ghcr.io/danny-avila/librechat:v0.8.1-rc1

WORKDIR /app

# Copy backend Judge0 integration files
COPY api/server/services/Tools/judge0-client.js /app/api/server/services/Tools/
COPY api/server/services/Tools/languages.js /app/api/server/services/Tools/
COPY api/server/services/Tools/judge0.js /app/api/server/services/Tools/
COPY api/app/clients/tools/util/handleTools.js /app/api/app/clients/tools/util/
COPY api/server/controllers/tools.js /app/api/server/controllers/

# Copy model icons to the DIST assets folder (where frontend serves from)
RUN mkdir -p /app/client/dist/assets
COPY client/public/assets/vertex-ai.svg /app/client/dist/assets/vertex-ai.svg
COPY client/public/assets/deepseek.svg /app/client/dist/assets/deepseek.svg
COPY client/public/assets/llama.svg /app/client/dist/assets/llama.svg
COPY client/public/assets/qwen.svg /app/client/dist/assets/qwen.svg

# Verify files were copied
RUN ls -la /app/api/server/services/Tools/ && \
    ls -la /app/api/server/controllers/ && \
    ls -la /app/client/dist/assets/ && \
    echo "Judge0 backend and model icons copied successfully"

ENV NODE_ENV=production

CMD ["npm", "run", "backend"]
